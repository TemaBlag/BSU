# Лабораторная работа №12  
## **Тема: Хранимые процедуры и триггеры**

---

### **Задания**  

#### **1. Хранимая процедура `GET_CUST`**
Напишите хранимую процедуру `GET_CUST`, которая получает идентификатор клиента и возвращает следующие данные:
- имя клиента (поле `COMPANY` из таблицы `CUSTOMERS`);  
- имя закрепленного за ним служащего (поле `FIO` из таблицы `SALESPERS`);  
- название города, в котором расположен офис этого клиента (поле `CITY` из таблицы `OFFICES`).  

Первый параметр — входной, остальные три — выходные параметры (используются для передачи запрашиваемых данных вызывающей процедуре).  
Продемонстрируйте вызов данной процедуры из другой процедуры Transact-SQL.

#### **2. Хранимая процедура `CHK_TOT`**
Напишите хранимую процедуру `CHK_TOT`, которая:
- получает идентификатор клиента;
- вычисляет общую стоимость его заказов (поле `AMOUNT` из таблицы `CUSTOMERS`);
- в зависимости от того, превысит ли эта сумма 30,000$, заносит в поле `STATUS` таблицы `OFFICES одно из двух значений:
  - "большой объем заказов", если сумма превышает 30,000$;
  - "малый объем заказов", если сумма меньше или равна 30,000$.

#### **3. Хранимую процедуру для добавления данных о новом клиенте в таблицу `OFFICES`**
Напишите хранимую процедуру для добавления нового клиента в таблицу `OFFICES`.  
**Требования к процедуре:**
- Добавление новой строки в таблицу `OFFICES` разрешается только для клиентов, которые уже имеют запись в таблице `CUSTOMERS`.
- Обновить запись в таблице `SALESPERS`, увеличив поле `QUOTA` для соответствующего служащего на величину объема продаж, добавленного в таблицу `OFFICES`.
- Плановый объем продаж служащего не может быть увеличен более чем на определенную величину:
  - Если сумма заказов клиента составляет менее 20,000$, величина объема продаж в таблице `OFFICES` будет добавлена к плану служащего.
  - Если сумма заказов клиента равна 20,000$, к плану будут добавлены фиксированные 20,000$.
  - Если сумма заказов больше 20,000$, запретить добавление новой записи в таблицу `OFFICES` и обновление записи в таблице `SALESPERS`.

Предусмотрите промежуточный вывод суммы заказов клиента перед добавлением данных.

#### **4. Триггер для обновления столбца `EMPL_NUM` в таблице `SALESPERS`**
Создайте триггер, который будет распространять любое обновление столбца `EMPL_NUM` в таблице `SALESPERS` на столбец `CUST_REP` таблицы `CUSTOMERS`.

#### **5. Триггер для вставки или изменения записи в таблице `CUSTOMERS`**
Создайте триггер, который будет запускаться каждый раз, когда запись вставляется в таблицу `CUSTOMERS` или модифицируется.  
Если заказ сделан не в первые 15 дней месяца, то запись не принимается.  
Для выделения определенной части даты (например, дня) в виде целого значения используйте функцию `DATEPART(date_part, date)`, где `date_part` может быть `day`, `month`, `year`.

---

**Примечания:**  
1. Для выполнения задания используйте возможности Transact-SQL в соответствующей СУБД.  
2. Оформите отчет по выполнению задания с подробным описанием каждого из шагов выполнения хранимых процедур и триггеров.
